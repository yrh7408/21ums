import{_ as I,E as u,o as c,e as f,w as a,a as t,r as x,c as D,f as w,b as d,g as E,F as P,h as q}from"./index-f2ea6133.js";import{E as B}from"./el-overlay-ad8ea762.js";import{a as g,E as G,b as R}from"./index-ed8c00ce.js";import{E as M}from"./el-popover-4e4e24c3.js";import{E as H}from"./el-switch-17596d63.js";import{E as J}from"./el-space-b976321f.js";import{a as K,b as k}from"./index-cc675372.js";import{a as U,b as Q,E as W}from"./el-form-item-66b1a363.js";import{a as O}from"./ums_member_receive_address-88175da1.js";import{a as X}from"./ums_member_tag-917dfbf4.js";import{E as Y}from"./index-76b37135.js";import{E as Z}from"./index-40b7cd74.js";import{E as $,a as ee}from"./index-b6ac6e26.js";const te={props:["id"],created(){O.Page(this.json).then(l=>{l.data.data.page.records.forEach(e=>{if(e.memberId==this.id){this.isFlag=!0,this.form=e;return}})})},data(){return{form:{},json:{current:1,size:99},isFlag:!1}},methods:{submit(){this.form.memberId=this.id,(this.isFlag?O.Edit(this.form):O.Add(this.form)).then(l=>{u({message:"操作成功",type:"success"}),this.form={}})}}};function se(l,e,V,b,s,i){const m=U,r=Q,y=W;return c(),f(y,{ref:"form",model:s.form,"label-width":"120px"},{default:a(()=>[t(y,{ref:"form",model:s.form,"label-width":"120px"},{default:a(()=>[t(r,{label:"收货人名称"},{default:a(()=>[t(m,{modelValue:s.form.name,"onUpdate:modelValue":e[0]||(e[0]=n=>s.form.name=n)},null,8,["modelValue"])]),_:1}),t(r,{label:"收货人手机"},{default:a(()=>[t(m,{modelValue:s.form.phoneNumber,"onUpdate:modelValue":e[1]||(e[1]=n=>s.form.phoneNumber=n)},null,8,["modelValue"])]),_:1}),t(r,{label:"省"},{default:a(()=>[t(m,{modelValue:s.form.province,"onUpdate:modelValue":e[2]||(e[2]=n=>s.form.province=n)},null,8,["modelValue"])]),_:1}),t(r,{label:"市"},{default:a(()=>[t(m,{modelValue:s.form.city,"onUpdate:modelValue":e[3]||(e[3]=n=>s.form.city=n)},null,8,["modelValue"])]),_:1}),t(r,{label:"区"},{default:a(()=>[t(m,{modelValue:s.form.region,"onUpdate:modelValue":e[4]||(e[4]=n=>s.form.region=n)},null,8,["modelValue"])]),_:1}),t(r,{label:"详细地址"},{default:a(()=>[t(m,{modelValue:s.form.detailAddress,"onUpdate:modelValue":e[5]||(e[5]=n=>s.form.detailAddress=n)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["model"])}const le=I(te,[["render",se]]);let T;const _=()=>{T=Y.service({lock:!0,text:"加载中...",spinner:"wave"})},h=()=>{T&&T.close()},ae=async l=>{_();try{return await g.request({url:`/mall/ums-member-tag/one/${l}`,method:"get"})}catch(e){throw e}finally{h()}},oe=async l=>{_();try{return await g.request({url:"/mall/ums-member-tag/del/"+l,method:"get"})}catch(e){throw e}finally{h()}},ne=async l=>{_();try{return await g.request({url:"/mall/ums-member-tag/edit",method:"post",data:l})}catch(e){throw e}finally{h()}},re=async l=>{_();try{return await g.request({url:"/mall/ums-member-member-tag-relation/add",method:"post",data:l})}catch(e){throw e}finally{h()}},ie=async l=>{_();try{return await g.request({url:"/mall/ums-member-member-tag-relation/page",method:"post",data:l})}catch(e){throw e}finally{h()}},v={One:ae,Del:oe,Edit:ne,Add:re,Page:ie};const de={components:{add:K,address_us:le},data(){return{json:{current:1,size:99},searchText:"",currentPage:1,pageSize:6,total:0,tableData:[],editDialogVisible:!1,editItem:{},selectedRow:null,addOpen:!1,addressOpen:!1,isFlag:!0,id:"",searchVal:"",tableDateCopy:[],tagTable:[],user_id:"",tag_id:"",tagOpen:!1}},created(){this.getList()},methods:{addressGan(l){this.user_id=l.id,this.addressOpen=!0},add(){this.isFlag=!0,this.addOpen=!0},selectNoe(l){let e=[];v.Page(this.json).then(V=>{V.data.data.page.records.forEach(async b=>{b.memberId==l.id&&await v.One(b.tagId).then(s=>{console.log(s.data.data.help.name),e.push(s.data.data.help.name)})}),setTimeout(()=>{e.length?u({message:"当前绑定标签有 :"+e.join("->"),type:"success"}):u({message:"当前会员没有绑定标签",type:"warning"})},300)})},submitTag(){this.tag_id?v.Add({memberId:this.user_id,tagId:this.tag_id}).then(l=>{l.data.code===1?u({message:l.data.msg,type:"success"}):u({message:l.data.msg,type:"error"}),this.tag_id="",this.tagOpen=!1}):u({message:"请选择标签再提交!",type:"error"})},setTag(l){this.user_id=l.id,X.Page(this.json).then(e=>{this.tagTable=e.data.data.page.records}),this.tagOpen=!0},statusChange(l){k.Edit(l).then(e=>{u({message:"修改状态成功!",type:"success"}),this.getList()})},search(){if(this.searchVal===""){this.tableData=this.tableDateCopy;return}let l=[];this.tableDateCopy.forEach(e=>{e.nickname.indexOf(this.searchVal)!==-1&&l.push(e)}),this.tableData=l},update_user(l){this.id=l.id,this.isFlag=!1,this.addOpen=!0},delete_user(l){k.Del(l.id).then(e=>{u({message:"删除成功!",type:"success"}),this.getList()})},getList(){k.Page(this.json).then(l=>{this.tableData=l.data.data.page.records,this.tableDateCopy=l.data.data.page.records})},onSubmit(){this.$refs.childComponent.submit(),this.addOpen=!1,setTimeout(()=>{this.getList()},100)},onSubmitAddressOpen(){this.$refs.childComponent1.submit(),this.addressOpen=!1,setTimeout(()=>{this.getList()},100)}}},me={class:"use_box"},ue={class:"dialog-footer"},pe={class:"dialog-footer"},ce={class:"dialog-footer"};function fe(l,e,V,b,s,i){const m=U,r=Z,y=J,n=R,z=H,F=M,L=G,A=x("add"),C=B,N=x("address_us"),S=ee,j=$;return c(),D("div",me,[t(m,{onInput:i.search,modelValue:s.searchVal,"onUpdate:modelValue":e[0]||(e[0]=o=>s.searchVal=o),placeholder:"请输入会员名称"},null,8,["onInput","modelValue"]),t(y,{style:{margin:"10px 0px"},size:l.size,spacer:"|"},{default:a(()=>[t(r,{onClick:i.add},{default:a(()=>[d(" 新增会员 ")]),_:1},8,["onClick"])]),_:1},8,["size"]),t(L,{border:"",data:s.tableData,stripe:"",style:{width:"100%"}},{default:a(()=>[t(n,{align:"center",prop:"nickname",label:"昵称"}),t(n,{align:"center",prop:"username",label:"账号"}),t(n,{align:"center",prop:"password",label:"密码"}),t(n,{align:"center",prop:"phone",label:"手机号"}),t(n,{align:"center",prop:"phone",label:"标签"},{default:a(o=>[t(r,{size:"small",onClick:p=>i.selectNoe(o.row),type:"success"},{default:a(()=>[d("查看标签")]),_:2},1032,["onClick"])]),_:1}),t(n,{align:"center",prop:"status",label:"启用状态"},{default:a(o=>[t(z,{"active-value":1,"inactive-value":0,modelValue:o.row.status,"onUpdate:modelValue":p=>o.row.status=p,onChange:p=>i.statusChange(o.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(n,{align:"center",prop:"createTime",label:"创建时间"}),t(n,{align:"center",prop:"phone",width:"400px",label:"操作"},{default:a(o=>[t(r,{size:"small",type:"success",onClick:p=>i.update_user(o.row)},{default:a(()=>[d("修改")]),_:2},1032,["onClick"]),t(r,{size:"small",onClick:p=>i.setTag(o.row),type:"success"},{default:a(()=>[d("设置标签")]),_:2},1032,["onClick"]),t(r,{size:"small",onClick:p=>i.addressGan(o.row),type:"success"},{default:a(()=>[d("地址管理")]),_:2},1032,["onClick"]),t(F,{onConfirm:p=>i.delete_user(o.row),title:"确定删除此会员吗?"},{reference:a(()=>[t(r,{size:"small",type:"danger"},{default:a(()=>[d("删除")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),s.addOpen?(c(),f(C,{key:0,modelValue:s.addOpen,"onUpdate:modelValue":e[2]||(e[2]=o=>s.addOpen=o),title:"操作",width:"30%"},{footer:a(()=>[E("span",ue,[t(r,{onClick:e[1]||(e[1]=o=>s.addOpen=!1)},{default:a(()=>[d("取 消")]),_:1}),t(r,{type:"primary",onClick:i.onSubmit},{default:a(()=>[d(" 提交 ")]),_:1},8,["onClick"])])]),default:a(()=>[t(A,{flag:s.isFlag,id:s.id,ref:"childComponent"},null,8,["flag","id"])]),_:1},8,["modelValue"])):w("",!0),s.addressOpen?(c(),f(C,{key:1,modelValue:s.addressOpen,"onUpdate:modelValue":e[4]||(e[4]=o=>s.addressOpen=o),title:"会员地址管理",width:"30%"},{footer:a(()=>[E("span",pe,[t(r,{onClick:e[3]||(e[3]=o=>s.addressOpen=!1)},{default:a(()=>[d("取 消")]),_:1}),t(r,{type:"primary",onClick:i.onSubmitAddressOpen},{default:a(()=>[d(" 提交 ")]),_:1},8,["onClick"])])]),default:a(()=>[t(N,{id:s.user_id,ref:"childComponent1"},null,8,["id"])]),_:1},8,["modelValue"])):w("",!0),s.tagOpen?(c(),f(C,{key:2,modelValue:s.tagOpen,"onUpdate:modelValue":e[7]||(e[7]=o=>s.tagOpen=o),title:"设置会员标签",width:"30%"},{footer:a(()=>[E("span",ce,[t(r,{onClick:e[6]||(e[6]=o=>s.tagOpen=!1)},{default:a(()=>[d("取 消")]),_:1}),t(r,{type:"primary",onClick:i.submitTag},{default:a(()=>[d(" 提交 ")]),_:1},8,["onClick"])])]),default:a(()=>[t(j,{modelValue:s.tag_id,"onUpdate:modelValue":e[5]||(e[5]=o=>s.tag_id=o)},{default:a(()=>[(c(!0),D(P,null,q(s.tagTable,o=>(c(),f(S,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])):w("",!0)])}const xe=I(de,[["render",fe],["__scopeId","data-v-e9617356"]]);export{xe as default};
